const delay = (timeout) =>
  new Promise((resolve) => setTimeout(resolve, timeout));

function getRandomInt(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}
let logErrors = [];
async function unFollows(page, numFollow) {
  await page.click('a[href="/friends/"]');
  await delay(3000);
  await page.click('a[href="/friends/list/"]');
  await delay(3000);
  let elapsedWaitTime = 0;
  while (elapsedWaitTime < 10000) {
    await page.mouse.wheel({ deltaY: getRandomInt(500, 700) });
    await delay(5000);
    elapsedWaitTime += 4000;
  }
  let count = 0;
  let moreButtons = await page.$$('div[class="x6s0dn4 x78zum5 x1q0g3np"]');

  while (count < numFollow) {
    try {
      let randomIndex = Math.floor(Math.random() * moreButtons.length);
      let moreButton = moreButtons[randomIndex];
      await delay(5000);
      await moreButton.click();
      await delay(3000);
      const unFollowsButton = await page.$(
        'div[class="x1i10hfl xjbqb8w x6umtig x1b1mbwd xaqea5y xav7gou xe8uvvx x1hl2dhg xggy1nq x1o1ewxj x3x9cwd x1e5q0jg x13rtm0m x87ps6o x1lku1pv x1a2a7pz xjyslct x9f619 x1ypdohk x78zum5 x1q0g3np x2lah0s xnqzcj9 x1gh759c xdj266r xat24cr x1344otq x1de53dj x1n2onr6 x16tdsg8 x1ja2u2z x6s0dn4 x1y1aw1k xwib8y2"]:nth-child(2)'
      );

      if (unFollowsButton == null) {
        logErrors.push({
          error: "Error while finding unfollow button",
          detail: "Unfollow button not found. Please check your selector.",
        });
      } else {
        try {
          await delay(3000);
          await unFollowsButton.click();
        } catch (error) {
          logErrors.push({
            error: "Error while clicking unfollow button",
            detail: error.message,
          });
        }
      }
      await delay(3000);
    } catch (error) {
      logErrors.push({
        error: "Error while processing unfriend button",
        detail: error.message,
      });
    }
  }
}
try {
  await unFollows(page, 2);
  await delay(10000);
} catch (error) {
  logErrors.push({
    error: "Error during unfollow execution",
    detail: error.message,
  });
}
return logErrors;